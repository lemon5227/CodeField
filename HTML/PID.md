# PID算法基本原理
PID算法的执行流程很简单，即用反馈来检测偏差信号，并通过偏差信号来控制被控量。
而控制器本身就是比例、积分、微分三三个环节的加和。其功能框图如下：
![流程](https://pic3.zhimg.com/v2-3d374655a126485563bc1068cee267fa_b.jpg)
根据上图我们考虑在某个特定的时刻t，此时输入量为rin(t),输出量为rout(t),于是偏差就可计算为err(t)=rin(t)-rout(t)。于是PID的基本控制规律就可以表示为如下公式：
![公式](https://pic1.zhimg.com/v2-62c56b1eb4c053d58894740a8ce250a0_b.jpg)
## 比例控制算法
<!--5.24 -->
相当于向一个水缸里加水，要求水位是1米，最终的控制目的是要保证水缸里的水位永远
维持在1米的高度。假设初始时刻，水缸的水位是0.2米，那么此时的水位和目标水位存在
一个误差error,且error为0.8,这个时刻向水缸加水的方式来控制水位。如果单纯的用比例
控制算法，就是指加入的水量u和误差是成正比的。即
u=kp*error；
那么假设kp取0.5，那么t=1时(表示第一次，也就是第一次对系统施加控制),那么u=0.5*0.8
=0.4，那么这一次加入的水量会使水位在0.2的基础上上升0.4，达到0.6。
接着t=2时刻（第二次施加控制），当前水位0.6，所以error时1-0.4=0.4.u=0.5*0.4=0.2.会使水位再次上升
0.2，达到0.8，如此循环下去，就是比例控制算法的运行方法，最终水位会达到我们需要的1米
但是，单单的比例控制存在一些不足，其中一点就是 __稳态误差__ ！
像上述的例子，根据取得kp值不同，系统最终都会到达1米，只不过kp大到达的快，小到达的慢，不会有稳态误差。
但是，考虑到另外的情况，假设加水时存在漏水的情况，每次加水都会漏掉0.1米高度的水。依旧假设kp=0.5，那么
会存在某种情况，经过几次加水后，水缸的水位到达0.8，水位不再变化！！因为，水位为0.8，error为0.2，
所以每次加进去的水为u=0.5*0.2=0.1。同时因为每次加水又漏出0.1米。加入的和流出的水相抵消，水位不再变化
也就是说，我的目标是1米，但是最后系统达到0.8米的水位就不再变化了，且系统已经到达稳定，由此产生的误差就是__稳态误差__。
(实际情况中，这种类似水缸漏水的情况往往很常见，比如控制汽车运动，摩擦阻力就相当于“漏水”，单独的比例控制，很多时候并不能满足要求。)
## 积分控制算法
<!--5.25 -->
还是上面的例子，如果仅仅用比例，可以发现存在暂态误差，最后的水位就卡在0.8了，于是，在控制中，我们再引入一个分量，该分量和误差的积分是正比关系。所以
比例+积分控制算法为：``` u=kp*error+ki *∫error ```
还是用上面的例子来说明，第一次的误差error是0.8，第二次的误差是0.4，至此，误差的积分（__离散情况下积分就是做累加__），∫error=0.8+0.4=1.2，这个
时候的控制量，除了比例的那一部分，还有一部分分就是一个系数ki乘以这个积分项。由于这个积分项会将前面若干次的误差进行累加，
所以可以很好的消除误差（假设在仅有比例想的情况下，系统卡在稳态误差了，即上例中的0.8，
由于加入了积分项的存在，会让输入增大，从而使得水缸的水位可以大于0.8，渐渐达到目的1.0）这就是积分项的作用。
## 微分控制算法
<!--5.26 -->
换一个另外的例子，考虑刹车情况。平稳的驾驶车辆，当我们发现前面有红灯时，为了使得行车平稳，基本上提前几十米就松油门，并踩刹车。当车辆离停车线
非常近的时候，则使劲踩刹车，使车辆停下来，整个过程可以看作一个加入微分的控制策略。
微分，说白了在离散情况下，就是error的差值，就是t时刻和t-1时刻的差，即u=kd*（(error)(t)-error(t-1))，
其中的kd是一个系数项。可以看到，在刹车过程中，因为error是越来越小的，所以这个微分项一定是负数，在控制中加入一个负数项，它的作用是为了防止汽车由于刹车
不及时而闯过了线。从常识上可以理解，越靠近停车线，越是应该注意踩刹车，不能让车过线,
所以这个微分项的作用可以理解为刹车，当车离停车线很近且车速还很快时，这个微分项的绝对值
（实际上是一个负数）就会很大，从而表示应该用力踩刹车才能让车停下来。切换到上面水缸加水的例子，。
就是当发现水缸里的水快要接近1的时候，加入微分项，可以仿真水缸里的水加到超过1米的高度，说白了
就是减少控制过程中的震荡。
***
现在回头再来看这个公式
![公式](https://pic1.zhimg.com/v2-62c56b1eb4c053d58894740a8ce250a0_b.jpg)
括号内第一项是比例项，第二项是积分项，第三项是微分项，前面仅仅是一个系数。很多情况下，仅仅需要在离散的时候使用，则控制可以化为：
![离散化公式](https://pic2.zhimg.com/v2-4326b375a25935a41bf3c5ed64eb7d65_b.jpg)
每一项前面都有系数，这些系数都是需要实验中去尝试然后确定的，为了方便起见，将这些系数进行统一一下：
![整理公式](https://pic1.zhimg.com/v2-25965fdad08db6f281dee7e0903229f0_b.jpg)
这样看就清晰很多了，且比例，微分，积分每个项前面都有一个系数，且离散化的公式，很适合编程实现。
# PID算法的离散化
PID算法在计算机上的实现必须将其离散化。
在离散化之前，我们需要对比例、积分、微分的特性做一个简单的说明。
* 比例就是用来对系统的偏差进行反应，所以只要存在偏差，比例就会起作用。
* 积分主要是用来消除静差，所谓静差就是指系统稳定后输入输出之间依然存在的差值，而积分就是通过偏差的累计来抵消系统的静差。
* 微分则是对偏差的变化趋势做出反应，根据偏差的变化趋势实现超前调节，提高反应速度。
在实现离散前，我们假设系统采样周期为T。假设我们检查第K个采样周期，
很显然系统进行第K次采样。此时的偏差可以表示为err(K)=rin(K)-rout(K)，
那么积分就可以表示为